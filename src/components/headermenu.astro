---
let open = false;
function toggleMenu() {
  open = !open;
}
---

<nav class="relative">
  <!-- Desktop menu -->
  <ul class="hidden md:flex space-x-4 items-center">
    <li><a href="/" class="hover:text-[#ED823A] font-bold">Inicio</a></li>
    <li>
      <a href="/services" class="hover:text-[#ED823A] font-bold">Servicios</a>
    </li>
    <li>
      <a href="/destinations" class="hover:text-[#ED823A] font-bold">Destinos</a
      >
    </li>
    <li>
      <a href="/schedules" class="hover:text-[#ED823A] font-bold">Horarios</a>
    </li>
    <li>
      <a href="/about" class="hover:text-[#ED823A] font-bold">Nosotros</a>
    </li>
    <li>
      <a
        href="#"
        data-open-reserva
        class="bg-[#E8782F] text-white font-bold px-6 py-3 rounded-lg text-lg shadow-lg hover:bg-[#ED823A] transition"
        >Reservar tu viaje</a
      >
    </li>
  </ul>

  <!-- Mobile hamburger -->
  <button
    id="menu-btn"
    class="md:hidden flex flex-col justify-center items-center w-10 h-10 border rounded text-white bg-[#E8782F]"
    aria-label="Abrir menú"
    type="button"
  >
    <span class="block w-7 h-1 bg-white rounded my-0.5"></span>
    <span class="block w-7 h-1 bg-white rounded my-0.5"></span>
    <span class="block w-7 h-1 bg-white rounded my-0.5"></span>
  </button>

  <ul
    id="mobile-menu"
    class="hidden absolute right-0 top-12 bg-[#155079] text-white w-56 rounded-lg shadow-lg flex-col space-y-2 p-4 z-50"
  >
    <li><a href="/" class="hover:text-[#ED823A] font-bold">Inicio</a></li>
    <li>
      <a href="/services" class="hover:text-[#ED823A] font-bold">Servicios</a>
    </li>
    <li>
      <a href="/destinations" class="hover:text-[#ED823A] font-bold">Destinos</a
      >
    </li>
    <li>
      <a href="/schedules" class="hover:text-[#ED823A] font-bold">Horarios</a>
    </li>
    <li>
      <a href="/about" class="hover:text-[#ED823A] font-bold">Nosotros</a>
    </li>
    
    <li>
      <a
        href="#"
        data-open-reserva
        class="bg-[#E8782F] text-white font-bold px-4 py-3 rounded-lg text-lg shadow-lg hover:bg-[#ED823A] transition block text-center"
        >Reservar tu viaje</a
      >
    </li>
  </ul>

  <script>
    (function () {
      function initHeaderMenu() {
        const btn = document.getElementById("menu-btn");
        const menu = document.getElementById("mobile-menu");

        if (btn && menu) {
          // evitar duplicar listeners
          if (!btn.getAttribute("_menuBound")) {
            btn.addEventListener("click", function () {
              if (menu.classList.contains("hidden")) {
                menu.classList.remove("hidden");
                menu.classList.add("flex");
              } else {
                menu.classList.add("hidden");
                menu.classList.remove("flex");
              }
            });
            btn.setAttribute("_menuBound", "1");
          }

          // Cerrar el menú al hacer clic en cualquier enlace
          menu.querySelectorAll("a").forEach(function (link) {
            if (!link.getAttribute("_closeBound")) {
              link.addEventListener("click", function () {
                menu.classList.add("hidden");
                menu.classList.remove("flex");
              });
              link.setAttribute("_closeBound", "1");
            }
          });
        }

        // Abrir modal de reserva desde cualquier botón con data-open-reserva
        var openBtns = document.querySelectorAll("[data-open-reserva]");
        if (!openBtns || openBtns.length === 0) {
          // nothing to do but not an error
        } else {
          openBtns.forEach(function (b) {
            if (!b.getAttribute("_openBound")) {
              b.addEventListener("click", function (e) {
                e.preventDefault();
                var modal = document.getElementById("reserve");
                if (modal) {
                  modal.classList.remove("hidden");
                  // focus al primer campo disponible
                  setTimeout(function () {
                    var first =
                      document.getElementById("servicio") ||
                      document.getElementById("origen");
                    if (first && typeof first.focus === "function")
                      first.focus();
                  }, 100);
                } else {
                  console.warn("Reserva: no se encontró el elemento #reserve");
                }

                // cerrar menú mobile si está abierto
                if (menu && !menu.classList.contains("hidden")) {
                  menu.classList.add("hidden");
                  menu.classList.remove("flex");
                }
              });
              b.setAttribute("_openBound", "1");
            }
          });
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initHeaderMenu);
      } else {
        // DOM already ready
        initHeaderMenu();
      }
    })();
  </script>
</nav>
